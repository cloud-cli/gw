{"/Users/darlan/Dropbox/labs/cloudy/gw/src/resource.ts":{"path":"/Users/darlan/Dropbox/labs/cloudy/gw/src/resource.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":26}},"2":{"start":{"line":5,"column":4},"end":{"line":5,"column":28}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":21}},"4":{"start":{"line":10,"column":8},"end":{"line":10,"column":42}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":42}},"6":{"start":{"line":16,"column":8},"end":{"line":16,"column":42}},"7":{"start":{"line":19,"column":8},"end":{"line":19,"column":42}},"8":{"start":{"line":22,"column":8},"end":{"line":22,"column":42}},"9":{"start":{"line":25,"column":8},"end":{"line":25,"column":42}},"10":{"start":{"line":28,"column":0},"end":{"line":28,"column":28}}},"fnMap":{"0":{"name":"notImplemented","decl":{"start":{"line":4,"column":9},"end":{"line":4,"column":23}},"loc":{"start":{"line":4,"column":37},"end":{"line":7,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":27},"end":{"line":11,"column":5}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":28},"end":{"line":14,"column":5}},"line":12},"3":{"name":"(anonymous_3)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":27},"end":{"line":17,"column":5}},"line":15},"4":{"name":"(anonymous_4)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":29},"end":{"line":20,"column":5}},"line":18},"5":{"name":"(anonymous_5)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":30},"end":{"line":23,"column":5}},"line":21},"6":{"name":"(anonymous_6)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":31},"end":{"line":26,"column":5}},"line":24}},"branchMap":{},"s":{"0":1,"1":1,"2":6,"3":6,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"f":{"0":6,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/darlan/Dropbox/labs/cloudy/gw/src/resource.ts","sources":["/Users/darlan/Dropbox/labs/cloudy/gw/src/resource.ts"],"names":[],"mappings":";;;AAIA,SAAS,cAAc,CAAC,CAAkB,EAAE,QAAwB;IAClE,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;IACxB,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;AACnB,CAAC;AACD,MAAa,QAAQ;IACnB,GAAG,CAAC,OAAwB,EAAE,QAAwB;QACpD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;IAED,IAAI,CAAC,OAAwB,EAAE,QAAwB;QACrD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;IAED,GAAG,CAAC,OAAwB,EAAE,QAAwB;QACpD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;IAED,KAAK,CAAC,OAAwB,EAAE,QAAwB;QACtD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;IAED,MAAM,CAAC,OAAwB,EAAE,QAAwB;QACvD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;IAED,OAAO,CAAC,OAAwB,EAAE,QAAwB;QACxD,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;CAIF;AA3BD,4BA2BC","sourcesContent":["import { Options, OptionsJson, OptionsText, OptionsUrlencoded } from 'body-parser';\nimport { CorsOptions } from 'cors';\nimport { IncomingMessage, ServerResponse } from 'http';\n\nfunction notImplemented(_: IncomingMessage, response: ServerResponse) {\n  response.writeHead(405);\n  response.end('');\n}\nexport class Resource {\n  get(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  post(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  put(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  patch(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  delete(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  options(request: IncomingMessage, response: ServerResponse): Promise<any> | void {\n    notImplemented(request, response);\n  }\n\n  body?: BodyParserOptions;\n  cors?: CorsOptions;\n}\n\ninterface BodyParserOptions {\n  raw?: Options;\n  json?: OptionsJson;\n  text?: OptionsText;\n  urlencoded?: OptionsUrlencoded;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f77de2faad2c76388712f532a9bb48df90d5643e","contentHash":"c5a983e394334247c7b201a77506472a62568acda220673ef9deb461abda690d"},"/Users/darlan/Dropbox/labs/cloudy/gw/src/gateway.ts":{"path":"/Users/darlan/Dropbox/labs/cloudy/gw/src/gateway.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":41}},"3":{"start":{"line":5,"column":13},"end":{"line":5,"column":28}},"4":{"start":{"line":6,"column":22},"end":{"line":6,"column":54}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":37}},"6":{"start":{"line":12,"column":8},"end":{"line":14,"column":48}},"7":{"start":{"line":17,"column":8},"end":{"line":17,"column":43}},"8":{"start":{"line":18,"column":8},"end":{"line":18,"column":20}},"9":{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},"10":{"start":{"line":22,"column":12},"end":{"line":22,"column":36}},"11":{"start":{"line":23,"column":12},"end":{"line":23,"column":76}},"12":{"start":{"line":24,"column":12},"end":{"line":24,"column":24}},"13":{"start":{"line":28,"column":27},"end":{"line":28,"column":55}},"14":{"start":{"line":29,"column":29},"end":{"line":29,"column":77}},"15":{"start":{"line":30,"column":8},"end":{"line":30,"column":44}},"16":{"start":{"line":33,"column":45},"end":{"line":33,"column":80}},"17":{"start":{"line":34,"column":25},"end":{"line":34,"column":57}},"18":{"start":{"line":35,"column":8},"end":{"line":46,"column":9}},"19":{"start":{"line":36,"column":12},"end":{"line":36,"column":64}},"20":{"start":{"line":37,"column":12},"end":{"line":37,"column":64}},"21":{"start":{"line":38,"column":12},"end":{"line":38,"column":64}},"22":{"start":{"line":39,"column":12},"end":{"line":39,"column":88}},"23":{"start":{"line":40,"column":12},"end":{"line":40,"column":65}},"24":{"start":{"line":43,"column":12},"end":{"line":43,"column":36}},"25":{"start":{"line":44,"column":12},"end":{"line":44,"column":29}},"26":{"start":{"line":45,"column":12},"end":{"line":45,"column":86}},"27":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"28":{"start":{"line":50,"column":12},"end":{"line":50,"column":19}},"29":{"start":{"line":52,"column":34},"end":{"line":52,"column":51}},"30":{"start":{"line":53,"column":8},"end":{"line":53,"column":53}},"31":{"start":{"line":54,"column":8},"end":{"line":54,"column":23}},"32":{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},"33":{"start":{"line":58,"column":12},"end":{"line":58,"column":19}},"34":{"start":{"line":60,"column":24},"end":{"line":60,"column":37}},"35":{"start":{"line":61,"column":34},"end":{"line":61,"column":51}},"36":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"37":{"start":{"line":63,"column":12},"end":{"line":63,"column":67}},"38":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"39":{"start":{"line":66,"column":12},"end":{"line":66,"column":67}},"40":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"41":{"start":{"line":69,"column":12},"end":{"line":69,"column":79}},"42":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"43":{"start":{"line":72,"column":12},"end":{"line":72,"column":65}},"44":{"start":{"line":74,"column":8},"end":{"line":74,"column":29}},"45":{"start":{"line":77,"column":20},"end":{"line":77,"column":22}},"46":{"start":{"line":78,"column":8},"end":{"line":78,"column":72}},"47":{"start":{"line":78,"column":48},"end":{"line":78,"column":69}},"48":{"start":{"line":79,"column":21},"end":{"line":79,"column":40}},"49":{"start":{"line":79,"column":27},"end":{"line":79,"column":40}},"50":{"start":{"line":80,"column":8},"end":{"line":80,"column":46}},"51":{"start":{"line":83,"column":45},"end":{"line":83,"column":80}},"52":{"start":{"line":84,"column":8},"end":{"line":88,"column":9}},"53":{"start":{"line":85,"column":12},"end":{"line":85,"column":36}},"54":{"start":{"line":86,"column":12},"end":{"line":86,"column":29}},"55":{"start":{"line":87,"column":12},"end":{"line":87,"column":24}},"56":{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},"57":{"start":{"line":91,"column":12},"end":{"line":91,"column":36}},"58":{"start":{"line":92,"column":12},"end":{"line":92,"column":29}},"59":{"start":{"line":93,"column":12},"end":{"line":93,"column":24}},"60":{"start":{"line":97,"column":0},"end":{"line":97,"column":26}},"61":{"start":{"line":98,"column":0},"end":{"line":98,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":4},"end":{"line":8,"column":5}},"loc":{"start":{"line":8,"column":18},"end":{"line":10,"column":5}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":32},"end":{"line":15,"column":5}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":24},"end":{"line":19,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":4},"end":{"line":20,"column":5}},"loc":{"start":{"line":20,"column":40},"end":{"line":26,"column":5}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":35},"end":{"line":31,"column":5}},"line":27},"5":{"name":"(anonymous_5)","decl":{"start":{"line":32,"column":4},"end":{"line":32,"column":5}},"loc":{"start":{"line":32,"column":40},"end":{"line":47,"column":5}},"line":32},"6":{"name":"(anonymous_6)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":51},"end":{"line":55,"column":5}},"line":48},"7":{"name":"(anonymous_7)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":51},"end":{"line":75,"column":5}},"line":56},"8":{"name":"(anonymous_8)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":17},"end":{"line":81,"column":5}},"line":76},"9":{"name":"(anonymous_9)","decl":{"start":{"line":78,"column":34},"end":{"line":78,"column":35}},"loc":{"start":{"line":78,"column":48},"end":{"line":78,"column":69}},"line":78},"10":{"name":"(anonymous_10)","decl":{"start":{"line":79,"column":21},"end":{"line":79,"column":22}},"loc":{"start":{"line":79,"column":27},"end":{"line":79,"column":40}},"line":79},"11":{"name":"(anonymous_11)","decl":{"start":{"line":82,"column":4},"end":{"line":82,"column":5}},"loc":{"start":{"line":82,"column":46},"end":{"line":95,"column":5}},"line":82}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":16},"end":{"line":14,"column":46}},"type":"binary-expr","locations":[{"start":{"line":12,"column":16},"end":{"line":12,"column":56}},{"start":{"line":13,"column":12},"end":{"line":13,"column":58}},{"start":{"line":14,"column":12},"end":{"line":14,"column":46}}],"line":12},"1":{"loc":{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},{"start":{"line":21,"column":8},"end":{"line":25,"column":9}}],"line":21},"2":{"loc":{"start":{"line":21,"column":12},"end":{"line":21,"column":59}},"type":"binary-expr","locations":[{"start":{"line":21,"column":12},"end":{"line":21,"column":31}},{"start":{"line":21,"column":35},"end":{"line":21,"column":59}}],"line":21},"3":{"loc":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":8},"end":{"line":51,"column":9}}],"line":49},"4":{"loc":{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},{"start":{"line":57,"column":8},"end":{"line":59,"column":9}}],"line":57},"5":{"loc":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},{"start":{"line":62,"column":8},"end":{"line":64,"column":9}}],"line":62},"6":{"loc":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"type":"if","locations":[{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},{"start":{"line":65,"column":8},"end":{"line":67,"column":9}}],"line":65},"7":{"loc":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},{"start":{"line":68,"column":8},"end":{"line":70,"column":9}}],"line":68},"8":{"loc":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},{"start":{"line":71,"column":8},"end":{"line":73,"column":9}}],"line":71},"9":{"loc":{"start":{"line":84,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":84,"column":8},"end":{"line":88,"column":9}},{"start":{"line":84,"column":8},"end":{"line":88,"column":9}}],"line":84},"10":{"loc":{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},{"start":{"line":89,"column":8},"end":{"line":94,"column":9}}],"line":89},"11":{"loc":{"start":{"line":89,"column":12},"end":{"line":90,"column":78}},"type":"binary-expr","locations":[{"start":{"line":89,"column":12},"end":{"line":89,"column":52}},{"start":{"line":90,"column":12},"end":{"line":90,"column":78}}],"line":89}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":12,"6":11,"7":10,"8":10,"9":11,"10":1,"11":1,"12":1,"13":18,"14":18,"15":18,"16":8,"17":8,"18":8,"19":8,"20":8,"21":8,"22":8,"23":8,"24":1,"25":1,"26":1,"27":8,"28":7,"29":1,"30":1,"31":1,"32":8,"33":4,"34":4,"35":4,"36":4,"37":1,"38":4,"39":1,"40":4,"41":1,"42":4,"43":1,"44":4,"45":5,"46":5,"47":5,"48":5,"49":5,"50":5,"51":10,"52":10,"53":1,"54":1,"55":1,"56":9,"57":1,"58":1,"59":1,"60":1,"61":1},"f":{"0":12,"1":11,"2":10,"3":11,"4":18,"5":8,"6":8,"7":8,"8":5,"9":5,"10":5,"11":10},"b":{"0":[11,10,8],"1":[1,10],"2":[11,1],"3":[7,1],"4":[4,4],"5":[1,3],"6":[1,3],"7":[1,3],"8":[1,3],"9":[1,9],"10":[1,8],"11":[9,8]},"inputSourceMap":{"version":3,"file":"/Users/darlan/Dropbox/labs/cloudy/gw/src/gateway.ts","sources":["/Users/darlan/Dropbox/labs/cloudy/gw/src/gateway.ts"],"names":[],"mappings":"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","sourcesContent":["import * as bodyParser from 'body-parser';\nimport * as cors from 'cors';\nimport { IncomingMessage, ServerResponse } from 'http';\nimport { Resource } from './resource';\n\nconst validMethodRe = /^(get|post|put|patch|delete)$/i;\n\nexport class Gateway {\n  private resources = new Map<string, Resource>([]);\n\n  dispatch(request: IncomingMessage, response: ServerResponse) {\n    return (\n      this.listAllEndpoints(request, response) ||\n      this.checkResourceAndMethod(request, response) ||\n      this.callMethod(request, response)\n    );\n  }\n\n  add(name: string, resource: Resource) {\n    this.resources.set(name, resource);\n    return this;\n  }\n\n  private listAllEndpoints(request: IncomingMessage, response: ServerResponse) {\n    if (request.url === '/' && request.method === 'GET') {\n      response.writeHead(200);\n      response.end(JSON.stringify(Array.from(this.resources.keys())));\n      return true;\n    }\n  }\n\n  private readMethodAndResource(request: IncomingMessage) {\n    const methodName = request.method.toLowerCase();\n    const resourceName = request.url.slice(1).toLowerCase().split('/')[0];\n\n    return { resourceName, methodName };\n  }\n\n  private async callMethod(request: IncomingMessage, response: ServerResponse) {\n    const { resourceName, methodName } = this.readMethodAndResource(request);\n    const resource = this.resources.get(resourceName);\n\n    try {\n      await this.processCors(request, response, resource);\n      await this.processBody(request, response, resource);\n\n      response.setHeader('X-Powered-by', '@cloud-cli/gw');\n      console.log(JSON.stringify({ method: methodName, resource: resourceName }));\n\n      return await resource[methodName](request, response);\n    } catch (error) {\n      response.writeHead(500);\n      response.end('');\n      console.log(JSON.stringify({ error: error.message, stack: error.stack }));\n    }\n  }\n\n  private async processCors(request: IncomingMessage, response: ServerResponse, resource: Resource) {\n    if (!resource.cors) {\n      return;\n    }\n\n    const { next, promise } = this.createNext();\n    cors(resource.cors)(request, response, next);\n\n    return promise;\n  }\n\n  private async processBody(request: IncomingMessage, response: ServerResponse, resource: Resource) {\n    if (!resource.body) {\n      return;\n    }\n\n    const options = resource.body;\n    const { next, promise } = this.createNext();\n\n    if (options.json) {\n      bodyParser.json(options.json)(request, response, next);\n    }\n\n    if (options.text) {\n      bodyParser.text(options.text)(request, response, next);\n    }\n\n    if (options.urlencoded) {\n      bodyParser.urlencoded(options.urlencoded)(request, response, next);\n    }\n\n    if (options.raw) {\n      bodyParser.raw(options.raw)(request, response, next);\n    }\n\n    return await promise;\n  }\n\n  private createNext() {\n    const out: any = {};\n    out.promise = new Promise((resolve) => (out.resolve = resolve));\n\n    const next = () => out.resolve();\n    return { next, promise: out.promise };\n  }\n\n  private checkResourceAndMethod(request: IncomingMessage, response: ServerResponse): boolean {\n    const { resourceName, methodName } = this.readMethodAndResource(request);\n\n    if (!this.resources.has(resourceName)) {\n      response.writeHead(404);\n      response.end('');\n      return true;\n    }\n\n    if (\n      validMethodRe.test(methodName) === false ||\n      typeof this.resources.get(resourceName)[methodName] !== 'function'\n    ) {\n      response.writeHead(405);\n      response.end('');\n      return true;\n    }\n  }\n}\n\nexport const gateway = new Gateway();\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bdf5e6583fbd7c02f33e4e4559b4c4a90de7eef3","contentHash":"4b0e25c6bb95140fcd732593ff76ac2834ac3307904f6a868b39ab3ff6329fb3"}}